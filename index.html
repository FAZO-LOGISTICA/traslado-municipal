<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TRASLADO MUNICIPAL</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .btn { @apply px-4 py-2 rounded-xl shadow-sm transition active:scale-[.98]; }
    .btn-primario { @apply bg-emerald-700 text-white hover:bg-emerald-800; }
    .btn-sec { @apply bg-slate-200 text-slate-800 hover:bg-slate-300; }
    .card { @apply bg-white/95 backdrop-blur rounded-2xl shadow p-5; }
  </style>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-800">
  <!-- Fondo -->
  <div class="fixed inset-0 -z-10 opacity-25"
       style="background-image:url('./assets/fondo-valpo.jpg');background-size:cover;background-position:center;"></div>

  <!-- Header -->
  <header class="bg-emerald-900 text-white px-4 py-6 sticky top-0 z-50 shadow">
    <div class="max-w-7xl mx-auto flex flex-col items-center justify-center gap-3">
      <img src="./assets/logo-valparaiso.png" alt="Valparaíso" class="w-40 h-auto object-contain"/>
      <h1 class="text-4xl sm:text-5xl font-extrabold tracking-wide text-center">TRASLADO MUNICIPAL</h1>
      <p class="text-emerald-100 text-lg">RESERVAS Y GESTIÓN DE VEHÍCULOS</p>

      <!-- Nav -->
      <nav class="flex items-center gap-4 mt-2">
        <button data-tab="registro" class="tablink btn btn-sec">REGISTRO</button>
        <button data-tab="vehiculos" class="tablink btn btn-sec">VEHÍCULOS & HORARIOS</button>
        <button data-tab="reservas"  class="tablink btn btn-sec">RESERVAS</button>
        <button data-tab="datos"     class="tablink btn btn-sec">DATOS</button>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-4 space-y-6">
    <!-- ============ REGISTRO ============ -->
    <section id="view-registro" class="space-y-6">
      <div class="card">
        <h2 class="text-2xl font-bold mb-4">NUEVA RESERVA</h2>
        <form id="formRegistro" class="grid grid-cols-1 md:grid-cols-2 gap-4" onsubmit="return false;">
          <div>
            <label class="block text-sm mb-1">NOMBRE DEL FUNCIONARIO</label>
            <input id="r-nombre" type="text" class="w-full border rounded-lg px-3 py-2 uppercase" placeholder="ESCRIBA EL NOMBRE"/>
          </div>
          <div>
            <label class="block text-sm mb-1">DEPARTAMENTO</label>
            <input id="r-depto" type="text" class="w-full border rounded-lg px-3 py-2 uppercase" placeholder="EJ: GESTIÓN DE FLOTA"/>
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm mb-1">DIRECCIÓN</label>
            <input id="r-direccion" type="text" class="w-full border rounded-lg px-3 py-2 uppercase" placeholder="EJ: DIRECCIÓN DE OPERACIONES"/>
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm mb-1">MOTIVO DEL TRASLADO</label>
            <input id="r-motivo" type="text" class="w-full border rounded-lg px-3 py-2 uppercase" placeholder="ESCRIBA EL MOTIVO"/>
          </div>
          <div class="md:col-span-2 flex items-center gap-3">
            <button type="button" id="btnSiguiente" class="btn btn-primario">SIGUIENTE</button>
            <button type="button" id="btnCancelar"  class="btn btn-sec">CANCELAR</button>
            <span id="msgRegistro" class="text-sm"></span>
          </div>
        </form>
      </div>
    </section>

    <!-- ============ VEHÍCULOS & HORARIOS ============ -->
    <section id="view-vehiculos" class="hidden space-y-5">
      <div class="card">
        <div class="flex items-start justify-between mb-4">
          <h2 class="text-2xl font-bold">VEHÍCULOS & HORARIOS</h2>
          <div id="resumenSolicitante" class="text-xs text-slate-600"></div>
        </div>
        <div id="listaVehiculos" class="space-y-4"></div>
      </div>
    </section>

    <!-- ============ RESERVAS ============ -->
    <section id="view-reservas" class="hidden space-y-4">
      <h2 class="text-2xl font-bold">RESERVAS</h2>
      <div class="card overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="text-left text-slate-600">
            <tr>
              <th class="py-2 pr-4">FECHA</th>
              <th class="py-2 pr-4">FUNCIONARIO</th>
              <th class="py-2 pr-4">DEPARTAMENTO</th>
              <th class="py-2 pr-4">DIRECCIÓN</th>
              <th class="py-2 pr-4">VEHÍCULO</th>
              <th class="py-2 pr-4">HORARIO</th>
              <th class="py-2 pr-4">ESTADO</th>
            </tr>
          </thead>
          <tbody id="tbodyReservas" class="align-top"></tbody>
        </table>
      </div>
    </section>

    <!-- ============ DATOS ============ -->
    <section id="view-datos" class="hidden space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="card"><div class="text-xs text-slate-500">TOTAL SOLICITUDES</div><div id="kpiTotal" class="text-2xl font-bold">—</div></div>
        <div class="card"><div class="text-xs text-slate-500">TASA APROBACIÓN</div><div id="kpiAprob" class="text-2xl font-bold">—</div></div>
        <div class="card"><div class="text-xs text-slate-500">VEHÍCULOS ACTIVOS</div><div id="kpiVehAct" class="text-2xl font-bold">—</div></div>
        <div class="card"><div class="text-xs text-slate-500">% OCUPACIÓN</div><div id="kpiOcup" class="text-2xl font-bold">—</div></div>
      </div>
    </section>
  </main>

  <!-- ================== JS ================== -->
  <script>
    const state = {
      registro: null,
      vehiculos: [],
      horariosBase: []
    };
    const $ = (s)=>document.querySelector(s);
    const el=(t,c="")=>{const n=document.createElement(t); if(c) n.className=c; return n;};
    const up=(v)=> (v||"").trim().toUpperCase();

    // Tabs
    function setActiveTab(tab){
      ["registro","vehiculos","reservas","datos"].forEach(v=>{
        $("#view-"+v).classList.toggle("hidden", v!==tab);
      });
    }

    document.querySelectorAll(".tablink").forEach(b=> b.addEventListener("click",()=>setActiveTab(b.dataset.tab)));

    // ---------- REGISTRO ----------
    $("#btnSiguiente").addEventListener("click", ()=>{
      const nombre = up($("#r-nombre").value);
      const depto  = up($("#r-depto").value);
      const direc  = up($("#r-direccion").value);
      const motivo = up($("#r-motivo").value);
      if(!nombre || !depto || !direc){
        $("#msgRegistro").textContent = "⚠️ CAMPOS OBLIGATORIOS";
        return;
      }
      state.registro = { nombre, depto, direccion: direc, motivo };
      setActiveTab("vehiculos");
      pintarResumenSolicitante();
      renderVehiculos();
    });

    $("#btnCancelar").addEventListener("click", ()=>{
      $("#formRegistro").reset();
      state.registro = null;
      $("#msgRegistro").textContent = "";
    });

    // ---------- VEHÍCULOS ----------
    function pintarResumenSolicitante(){
      const r = state.registro;
      $("#resumenSolicitante").innerHTML = r
        ? `Solicitante: ${r.nombre} · Depto: ${r.depto} · Dirección: ${r.direccion}`
        : `<span class="text-red-600">⚠️ COMPLETE EL REGISTRO</span>`;
    }

    function renderVehiculos(){
      const cont = $("#listaVehiculos"); cont.innerHTML = "";
      const data = [
        { id:"FORD4X4",  tipo:"FORD RANGER 4X4",   patente:"AB-DF12", capacidad:"5 PAX",  foto:"./vehiculos/ford_ranger_4x4.jpg" },
        { id:"NAVARA",   tipo:"NISSAN NAVARA 4X2", patente:"CD-EF34", capacidad:"3 PAX",  foto:"./vehiculos/nissan_navara_4x2.jpg" },
        { id:"KIA",      tipo:"KIA FRONTIER CARGA",patente:"GH-IJ56", capacidad:"1.5T",   foto:"./vehiculos/kia_frontier_carga.jpg" },
        { id:"VAN",      tipo:"NISSAN NV350 14P",  patente:"KL-MN78", capacidad:"14 PAX", foto:"./vehiculos/nissan_nv350_14p.jpg" }
      ];

      data.forEach(v=>{
        const card = el("div","border rounded-2xl p-4 flex flex-col md:flex-row gap-4 items-start md:items-center bg-white/80");
        const img  = el("img","w-full md:w-48 h-32 object-cover rounded-xl");
        img.src = v.foto; img.alt=v.tipo;
        const info = el("div","flex-1 w-full");
        info.innerHTML = `<div class="text-lg font-semibold">${v.tipo}</div>
                          <div class="text-sm text-slate-500">PATENTE: ${v.patente} · CAP.: ${v.capacidad}</div>`;
        card.appendChild(img); card.appendChild(info);
        cont.appendChild(card);
      });
    }
  </script>
</body>
</html>
